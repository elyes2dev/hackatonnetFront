<div class="quiz-form-container">
    <h2>{{ isEditMode ? 'Edit Quiz' : 'Create New Quiz' }}</h2>
    <p class="workshop-id">Workshop ID: {{ workshopId }}</p>
  
    <div *ngIf="error" class="error-message">{{ error }}</div>
    <div *ngIf="loading" class="loading-message">Saving quiz...</div>
  
    <form [formGroup]="quizForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="title">Quiz Title *</label>
        <input 
          type="text" 
          id="title" 
          formControlName="title" 
          [class.invalid]="quizForm.get('title')?.invalid && quizForm.get('title')?.touched">
        <div *ngIf="quizForm.get('title')?.invalid && quizForm.get('title')?.touched" class="validation-error">
          Title is required and must be at least 3 characters
        </div>
      </div>
  
      <div class="form-group checkbox-group">
        <input type="checkbox" id="isPublished" formControlName="isPublished">
        <label for="isPublished">Publish Quiz</label>
      </div>
  
      <h3>Questions</h3>
      
      <div class="questions-container">
        <div *ngFor="let questionCtrl of questionsArray.controls; let i = index" class="question-card" 
             [class.active]="currentQuestionIndex === i" [formGroup]="getQuestionFormGroup(questionCtrl)">
  
          <div class="question-header">
            <h4>Question #{{i + 1}}</h4>
            <button type="button" class="delete-button" (click)="removeQuestion(i)">×</button>
          </div>
          
          <div class="form-group">
            <label>Question Text *</label>
            <input 
              type="text" 
              formControlName="questionText"
              [class.invalid]="getQuestionFormGroup(questionCtrl).get('questionText')?.invalid && 
                              getQuestionFormGroup(questionCtrl).get('questionText')?.touched">
            <div *ngIf="getQuestionFormGroup(questionCtrl).get('questionText')?.invalid && 
                       getQuestionFormGroup(questionCtrl).get('questionText')?.touched" 
                 class="validation-error">
              Question text is required
            </div>
            
            <label>Answers *</label>
            <div formArrayName="answers">
              <div *ngFor="let answerCtrl of getAnswers(getQuestionFormGroup(questionCtrl)).controls; let j = index" 
                   class="answer-row">
                <input 
                  type="radio" 
                  name="correctAnswer_{{i}}" 
                  [value]="j"
                  [checked]="getQuestionFormGroup(questionCtrl).get('correctAnswerIndex')?.value === j"
                  (change)="getQuestionFormGroup(questionCtrl).get('correctAnswerIndex')?.setValue(j)">
                <input 
                  type="text" 
                  [class.invalid]="answerCtrl.invalid && answerCtrl.touched">
                <button type="button" class="remove-answer" (click)="removeAnswer(i, j)">×</button>
                <div *ngIf="answerCtrl.invalid && answerCtrl.touched" class="validation-error">
                  Answer is required
                </div>
              </div>
            </div>
            
            <button type="button" class="add-answer" (click)="addAnswer(i)">
              + Add Answer
            </button>
          </div>
        </div>
      </div>
  
      <button type="button" class="add-question" (click)="addQuestion()">
        + Add Question
      </button>
  
      <div class="form-actions">
        <button type="submit" class="submit-button" [disabled]="quizForm.invalid || loading">
          {{ isEditMode ? 'Update Quiz' : 'Create Quiz' }}
        </button>
        <button type="button" class="cancel-button" (click)="router.navigate(['/workshops', workshopId])">
          Cancel
        </button>
      </div>
    </form>
  </div>