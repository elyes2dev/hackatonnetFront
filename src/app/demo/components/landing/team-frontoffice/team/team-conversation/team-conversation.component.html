<div class="chat-wrapper">
  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-overlay">
    <p-progressSpinner></p-progressSpinner>
  </div>

  <!-- Chat Container -->
  <div class="chat-container" #chatContainer [class.loading]="loading">
    <!-- Date Separator -->
    <ng-container *ngFor="let msg of discussions; let i = index">
      <div class="date-separator" *ngIf="i === 0 || getMessageDate(msg.createdAt) !== getMessageDate(discussions[i-1].createdAt)">
        <span>{{ getMessageDate(msg.createdAt) }}</span>
      </div>

      <!-- Message -->
      <div class="message" [class.current-user]="isCurrentUserMessage(msg.teamMember?.user?.id)">
        <div class="message-header">
          <span class="user-avatar" [attr.data-initials]="getUserInitials(msg.teamMember?.user?.name)">
            {{ getUserInitials(msg.teamMember?.user?.name) }}
          </span>
          <div class="message-content-wrapper">
            <div class="message-info">
              <span class="username">{{ msg.teamMember?.user?.name || 'Unknown' }}</span>
              <span class="timestamp">{{ getMessageTime(msg.createdAt) }}</span>
            </div>
            <div class="message-content">
              <p>{{ msg.message }}</p>
            </div>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- Empty State -->
    <div *ngIf="!loading && discussions.length === 0" class="empty-state">
      <i class="pi pi-comments"></i>
      <p>No messages yet. Start the conversation!</p>
    </div>
  </div>

  <!-- Message Input -->
  <form (ngSubmit)="sendMessage()" class="message-input-form">
    <div class="input-wrapper">
      <input pInputText 
             [(ngModel)]="newMessage" 
             name="newMessage" 
             placeholder="Type your message here..." 
             [disabled]="loading"
             class="message-input" 
             (keydown.enter)="$event.preventDefault(); sendMessage()">
      <button pButton 
              type="submit" 
              icon="pi pi-send" 
              [disabled]="!newMessage.trim() || loading"
              class="send-button p-button-rounded p-button-text">
      </button>
    </div>
  </form>
</div>