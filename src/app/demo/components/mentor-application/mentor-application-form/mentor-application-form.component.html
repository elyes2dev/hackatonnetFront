<div class="grid">
    <div class="col-12">
      <div class="card">
        <h5>Mentor Application Form</h5>
        
        <form [formGroup]="applicationForm" (ngSubmit)="onSubmit()" class="p-fluid">
          <!-- Application Text -->
          <div class="field">
            <label for="applicationText">Application Text*</label>
            <textarea 
              pInputTextarea 
              id="applicationText" 
              formControlName="applicationText" 
              rows="5"
              [class.ng-invalid]="applicationForm.get('applicationText')?.invalid && applicationForm.get('applicationText')?.touched"
              [class.ng-dirty]="applicationForm.get('applicationText')?.invalid && applicationForm.get('applicationText')?.touched">
            </textarea>
            <small *ngIf="applicationForm.get('applicationText')?.invalid && applicationForm.get('applicationText')?.touched" class="p-error">
              Application text is required and must be at least 100 characters long.
            </small>
          </div>
  
          <!-- Links Section -->
          <div class="field">
            <label>Links (optional)</label>
            <div formArrayName="links" *ngFor="let link of links.controls; let i = index" class="p-inputgroup mb-2">
              <input 
                pInputText 
                [formControlName]="i" 
                placeholder="https://example.com"
                [class.ng-invalid]="links.at(i).invalid && links.at(i).touched"
                [class.ng-dirty]="links.at(i).invalid && links.at(i).touched">
              <button 
                pButton 
                pRipple 
                type="button" 
                icon="pi pi-times" 
                class="p-button-danger" 
                (click)="removeLink(i)"
                [disabled]="links.length <= 1"></button>
            </div>
            <button 
              pButton 
              pRipple 
              type="button" 
              icon="pi pi-plus" 
              label="Add Link" 
              class="p-button-secondary p-button-sm" 
              (click)="addLink()"></button>
          </div>
  
          <!-- File Uploads -->
          <div class="grid">
            <div class="col-12 md:col-6">
              <div class="field">
                <label for="cvFile">Upload CV*</label>
                <p-fileUpload 
                  mode="basic" 
                  id="cvFile"
                  name="cvFile" 
                  accept=".pdf,.doc,.docx" 
                  [maxFileSize]="5000000"
                  (onSelect)="onCvFileChange($event)"
                  chooseLabel="Select CV">
                </p-fileUpload>
                <small *ngIf="!cvFile && applicationForm.touched" class="p-error">CV is required.</small>
              </div>
            </div>
            <div class="col-12 md:col-6">
              <div class="field">
                <label for="uploadPaperFile">Upload Paper (optional)</label>
                <p-fileUpload 
                  mode="basic" 
                  id="uploadPaperFile"
                  name="uploadPaperFile" 
                  accept=".pdf,.doc,.docx" 
                  [maxFileSize]="5000000"
                  (onSelect)="onUploadPaperFileChange($event)"
                  chooseLabel="Select Paper">
                </p-fileUpload>
              </div>
            </div>
          </div>
  
          <!-- Previous Experience Toggle -->
          <div class="field-checkbox mb-3">
            <p-checkbox 
              id="hasPreviousExperience" 
              formControlName="hasPreviousExperience"
              [binary]="true"
              inputId="hasPreviousExperience"></p-checkbox>
            <label for="hasPreviousExperience">I have previous mentoring experience</label>
          </div>
  
          <!-- Previous Experiences -->
          <div *ngIf="applicationForm.get('hasPreviousExperience')?.value">
            <div class="field">
              <label>Previous Experiences</label>
              <div formArrayName="previousExperiences">
                <ng-container *ngFor="let exp of previousExperiences.controls; let i = index">
                  <app-previous-experience-form
                    [experienceForm]="getFormGroupAt(i)"
                    [index]="i"
                    (removeExperienceEvent)="removeExperience($event)">
                  </app-previous-experience-form>
                </ng-container>
              </div>
              <button 
                pButton 
                pRipple 
                type="button" 
                icon="pi pi-plus" 
                label="Add Experience" 
                class="p-button-secondary p-button-sm" 
                (click)="addExperience()"></button>
            </div>
          </div>
  
          <!-- Submit Button -->
          <div class="field mt-4">
            <button 
              pButton 
              pRipple 
              type="submit" 
              label="Submit Application" 
              class="p-button-primary"
              [disabled]="submitting || applicationForm.invalid || !cvFile">
              <i *ngIf="submitting" class="pi pi-spinner pi-spin mr-2"></i>
            </button>
            <small *ngIf="errorMessage" class="p-error block">{{errorMessage}}</small>
          </div>
        </form>
      </div>
    </div>
  </div>